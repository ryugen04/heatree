# 📋 プロジェクト企画書 - heatree

## プロジェクト概要

### プロダクト名
**heatree** (Heat + Tree)

### エレベーターピッチ
新規プロジェクトにアサインされた開発者が、コードベースの構造・規模・変更頻度を視覚的に理解できるターミナルベースのツール

### 解決する課題

#### ペインポイント
1. **オンボーディングに時間がかかる**: 新しいプロジェクトでコードベース全体を把握するのに数週間かかる
2. **どこから見るべきか分からない**: 重要なファイルや頻繁に変更される箇所が不明
3. **技術的負債の可視化が困難**: どのファイルが複雑で変更が多いか（ホットスポット）が見えない
4. **ドキュメントが不足/古い**: 既存ドキュメントがコード構造を反映していない

#### ターゲットユーザー
- 新規プロジェクトにアサインされたエンジニア
- 大規模コードベースを理解したい開発者
- リファクタリング対象を特定したい技術リード
- コードレビューで全体像を把握したいレビュアー

### なぜTUIなのか

#### TUIを選択する理由
1. **開発者のワークフローに統合**: ターミナルから離れずに使用可能
2. **軽量・高速**: ブラウザやGUIアプリより起動が速い
3. **リモート環境での利用**: SSHでの作業環境でも使える
4. **キーボード操作**: マウス不要で高速なナビゲーション

## 機能要件

### MVP (v0.1.0)

#### 必須機能

**1. ツリー構造表示**
- ディレクトリ・ファイルの階層表示
- フォルダの展開/折りたたみ
- 現在位置のハイライト表示

**2. コード行数の可視化**
- ファイルごとの行数カウント
- ディレクトリごとの合計行数表示
- 6段階のカラーコーディング
  - < 50行: Blue
  - 50-100行: Cyan
  - 100-200行: Green
  - 200-500行: Yellow
  - 500-1000行: Orange
  - 1000行以上: Red

**3. 変更頻度の可視化**
- Git履歴からの変更回数カウント
- 1日あたりの平均変更回数の計算
- 5段階のカラーコーディング
  - Low (<1.7/day): Blue
  - Medium-Low (1.7-3.4/day): Cyan
  - Medium (3.4-5.2/day): Green
  - Medium-High (5.2-6.9/day): Yellow
  - High (6.9+/day): Red

**4. 基本操作**
- 上下移動（矢印キー、vim風キーバインド）
- 展開/折りたたみ（Enter、Space）
- 表示モード切り替え（行数 ⇔ 変更頻度）
- ヘルプ表示
- 終了

#### MVP範囲外（将来機能）
- ファイル内容の表示
- エディタとの連携
- 複雑度メトリクスの表示
- 複数リポジトリの比較
- 設定ファイルのサポート

### Phase 2以降の機能

**Phase 2 (v0.2.0): フィルタリング & エクスポート**
- 時間範囲指定（日/週/月）
- ファイル拡張子フィルタ
- 検索機能（ファイル名）
- JSON/CSV出力

**Phase 3 (v0.3.0): 高度な分析**
- 循環的複雑度の統合
- カスタムカラースキーム
- 設定ファイル（.heatreerc）
- 除外パターン設定

**Phase 4 (v1.0.0): 成熟**
- パフォーマンス最適化
- マルチプラットフォーム対応
- ドキュメント充実
- リリース自動化

## 非機能要件

### パフォーマンス
- **起動時間**: 1秒以内（小〜中規模リポジトリ）
- **応答性**: キー入力に対して即座に反応（<50ms）
- **メモリ使用量**: 100MB以下（通常のリポジトリ）
- **大規模対応**: 10,000ファイル以上のリポジトリでも動作

### 互換性
- **Go バージョン**: 1.21以上
- **Git バージョン**: 2.0以上
- **ターミナル**: 256色対応
- **OS**: Linux, macOS, Windows（WSL含む）

### ユーザビリティ
- **学習曲線**: 5分以内に基本操作を習得可能
- **直感性**: カラーコードが直感的に理解できる
- **アクセシビリティ**: キーボードのみで全機能にアクセス可能

### 保守性
- **コード品質**: テストカバレッジ80%以上
- **ドキュメント**: 全公開APIにドキュメントコメント
- **依存関係**: 最小限の外部依存

## ユーザーストーリー

### ストーリー1: 新規プロジェクトへのアサイン
```
As a: 新規プロジェクトにアサインされたエンジニア
I want to: プロジェクトのコード構造を素早く把握したい
So that: どこから学習を始めるべきか判断できる
```

**シナリオ:**
1. プロジェクトディレクトリで `heatree .` を実行
2. ツリー構造で全体像を確認
3. 行数の多いファイル（大きな実装）を特定
4. 変更頻度の高いファイル（活発に開発中）を特定
5. 重点的に理解すべき箇所を把握

### ストーリー2: リファクタリング対象の特定
```
As a: 技術リード
I want to: 技術的負債のホットスポットを特定したい
So that: リファクタリングの優先順位を決められる
```

**シナリオ:**
1. リポジトリで `heatree --mode frequency` を実行
2. 変更頻度の高いファイルを確認
3. 行数も多く変更も多いファイル（ホットスポット）を特定
4. チームで議論してリファクタリング計画を立てる

### ストーリー3: コードレビューの準備
```
As a: コードレビュアー
I want to: PRの影響範囲を可視化したい
So that: レビューすべき重要なファイルを理解できる
```

**シナリオ:**
1. PR前後で `heatree` を実行して比較
2. 変更されたファイルの規模と位置を確認
3. 周辺ファイルの変更頻度を確認
4. 影響範囲を考慮したレビューを実施

## UI/UX要件

### レイアウト構成

```
┌─────────────────────────────────────────┐
│ Header                                  │ 2行
├─────────────────────────────────────────┤
│ Options Bar                             │ 2行
├─────────────────────────────────────────┤
│ Legend                                  │ 2行
├─────────────────────────────────────────┤
│                                         │
│ Tree View (メインコンテンツ)              │ 可変
│                                         │
├─────────────────────────────────────────┤
│ Footer                                  │ 1行
└─────────────────────────────────────────┘
```

### カラーパレット

**ダークテーマ（デフォルト）:**
- Background: `#1a1b26`
- Foreground: `#c0caf5`
- Border: `#414868`

**ヒートマップカラー:**
- Blue: `#0EA5E9` (低)
- Cyan: `#06B6D4`
- Green: `#10B981` (中)
- Yellow: `#F59E0B`
- Orange: `#F97316`
- Red: `#EF4444` (高)

### インタラクションパターン

**キーボードナビゲーション:**
- 上下移動: 矢印キーまたはVim風（j/k）
- 展開/折りたたみ: Space、Enter、または矢印キー（→/←）
- モード切替: Tab または数字キー（1/2）
- 終了: q または Ctrl+C

**ビジュアルフィードバック:**
- 現在行のハイライト
- フォルダの展開状態を示すアイコン（▼/▶）
- ヒートマップバーによる視覚的な比較
- スムーズなスクロール

## データ要件

### 入力データ

**必須:**
- Git リポジトリのパス
- `.git` ディレクトリの存在

**オプション:**
- 分析期間（デフォルト: 30日）
- 除外パターン（デフォルト: node_modules, .git, vendor など）
- 対象拡張子（デフォルト: すべて）

### 計算ロジック

**行数カウント:**
- 空行を除外
- コメント行は含める（デフォルト）
- バイナリファイルはスキップ

**変更頻度:**
```
変更頻度 = 対象期間内のコミット数 / 対象期間（日数）
```

例: 30日間で21回コミット → 21 / 30 = 0.7回/日

**ディレクトリのメトリクス:**
- 行数: 子要素の合計
- 変更頻度: 子要素の平均

## 成功指標

### 定量的指標
- **ダウンロード数**: 最初の3ヶ月で1,000ダウンロード
- **GitHub Stars**: 最初の6ヶ月で500スター
- **起動時間**: 中規模リポジトリで1秒以内
- **カバレッジ**: テストカバレッジ80%以上

### 定性的指標
- **使いやすさ**: 初回利用者が5分以内に基本操作を習得
- **価値提供**: ユーザーがオンボーディング時間を短縮できたと感じる
- **コミュニティ**: Issue、PR、フィードバックが活発

## リスクと制約

### 技術的リスク
- **大規模リポジトリの性能**: 10,000ファイル以上での動作が遅い可能性
- **Git履歴の解析負荷**: 長い歴史を持つリポジトリでの分析時間
- **ターミナル環境の多様性**: すべての環境で正しく表示されない可能性

### 対策
- Lazy loading と incremental updates
- Git履歴のキャッシング
- フォールバックの色設定

## 競合分析

| ツール | タイプ | 強み | 弱み |
|--------|--------|------|------|
| code-forensics | Web | 多機能、視覚的 | セットアップが複雑 |
| CodeScene | SaaS | 包括的分析 | 有料、大規模向け |
| gitinspector | CLI | シンプル、軽量 | 対話性なし |
| GitStats | CLI | 統計重視 | TUIなし |

**heatreeの差別化:**
- ✅ TUIによる対話的な操作
- ✅ 即座に使えるシンプルさ
- ✅ オンボーディングに特化
- ✅ ターミナルから離れない

## 次のステップ

### 即座に実施
1. ✅ GitHubリポジトリ作成
2. ✅ ドキュメント配置
3. ⏳ プロトタイプ開発（Claude Code使用）

### 短期（1-2週間）
- MVP実装
- 基本的なテスト
- README完成

### 中期（1-2ヶ月）
- Phase 2機能実装
- コミュニティフィードバック収集
- ドキュメント充実

### 長期（3-6ヶ月）
- v1.0.0リリース
- 主要パッケージマネージャーへの登録
- ブログ記事・紹介動画作成
